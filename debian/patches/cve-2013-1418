From f899337e37ef770cceb6e5fd6e13bf8223104f6a Mon Sep 17 00:00:00 2001
From: Sam Hartman <hartmans@debian.org>
Date: Mon, 18 Nov 2013 23:39:18 -0500
Subject: Import upstream 7757 patch

origin: http://krbdev.mit.edu/rt/Ticket/Display.html?id=7757
author: Tom Yu <tlyu@mit.edu>

Patch-Name: cve-2013-1418
Patch-Category: upstream
---
 src/kdc/main.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/kdc/main.c b/src/kdc/main.c
index 0f5961a..a7ffe63 100644
--- a/src/kdc/main.c
+++ b/src/kdc/main.c
@@ -124,6 +124,9 @@ setup_server_realm(struct server_handle *handle, krb5_principal sprinc)
     kdc_realm_t **kdc_realmlist = handle->kdc_realmlist;
     int kdc_numrealms = handle->kdc_numrealms;
 
+    if (sprinc == NULL)
+        return NULL;
+
     if (kdc_numrealms > 1) {
         if (!(newrealm = find_realm_data(handle, sprinc->realm.data,
                                          (krb5_ui_4) sprinc->realm.length)))
